[phases.setup]
nixPkgs = ["busybox", "nodejs", "nodePackages.pm2"]
aptPkgs = ["ca-certificates", "curl", "wget"]
cmds = [
    "curl -fsSL https://bun.sh/install | bash",
    "echo 'export BUN_INSTALL=\"$HOME/.bun\"' >> $HOME/.bashrc",
    "echo 'export PATH=\"$BUN_INSTALL/bin:$PATH\"' >> $HOME/.bashrc",
    "source $HOME/.bashrc || true",
    "ln -s $HOME/.bun/bin/bun /usr/local/bin/bun || true",  # Create a symlink for global access
    "chmod +x $HOME/.bun/bin/bun"  # Ensure bun is executable
]

# Define environment variables that persist across all phases
[phases.setup.env]
BUN_INSTALL = "$HOME/.bun"
PATH = "$HOME/.bun/bin:$PATH"

[phases.install]
cmds = [
    "$HOME/.bun/bin/bun --version",
    "$HOME/.bun/bin/bun install"
]

[phases.build]
cmds = [
    "$HOME/.bun/bin/bun run build"
]

[start]
cmd = '/assets/start.sh'